# Keymap 优化总结

> 优化时间：2026-02-17  
> 优化文件：`keymaps.lua`、`snacks.lua`、`utils.lua`

---

## ✅ 已完成的优化

### 1. 添加图标美化系统

**在 `utils.lua` 中新增 `keymaps` 图标集：**
- 文件相关图标（查找文件、Git 文件、最近文件等）
- 搜索相关图标（全局搜索、搜索单词、作用域）
- Git 相关图标（状态、暂存、差异、日志、分支）
- 窗口管理图标（上下左右）
- 编辑操作图标（移动、复制）
- 导航图标（上一个、下一个）
- Neovim 内部功能图标（命令、寄存器、标记等）

### 2. 重构 `keymaps.lua` 顺序

**优化后的结构：**
1. **模式切换** - 插入模式退出
2. **窗口管理** - 普通模式和终端模式的窗口切换（合并在一起）
3. **编辑操作** - 行移动（普通模式和可视模式合并）
4. **剪贴板** - 系统剪贴板复制
5. **导航** - 光标位置历史
6. **文件操作** - 保存所有缓冲区

**改进点：**
- ✅ 按功能分组，每组之间用注释分隔
- ✅ 相关功能放在一起（如窗口管理的不同模式）
- ✅ 所有键位描述都添加了图标
- ✅ 统一使用中文描述

### 3. 重构 `snacks.lua` 键位顺序

**优化后的分组：**
1. **文件树** - `<leader>e`
2. **文件查找** - `<leader>ff/fg/fr/fc/fb`（按使用频率排序）
3. **搜索** - `<leader>sg/sw/sj`（搜索相关功能集中）
4. **Git** - `<leader>gs/gS/gd/gl/gb`（Git 功能集中）
5. **Neovim 内部功能** - `<leader>fC/fh/fR/fm/fj/fk/fT`（使用大写字母区分）
6. **Quickfix/Location** - `<leader>xq/xl`
7. **终端** - `<C-\>`

**改进点：**
- ✅ 按功能逻辑分组，结构清晰
- ✅ 所有键位描述都添加了图标
- ✅ 统一使用中文描述
- ✅ 搜索相关功能集中在一起

---

## 📊 优化前后对比

### 优化前

```lua
-- 无图标，顺序混乱
map("i", "jk", "<Esc>", { desc = "退出插入模式" })
map("n", "<C-h>", "<C-w>h", { desc = "焦点左窗口" })
map("t", "<C-h>", "<C-\\><C-n><C-w>h", { desc = "焦点左窗口" })
map("v", "<C-c>", '"+y', { desc = "复制到系统剪贴板" })
```

### 优化后

```lua
-- 有图标，按功能分组
-- =======================
-- 1. 模式切换
-- =======================
map("i", "jk", "<Esc>", { desc = icons.exit_insert .. "退出插入模式" })

-- =======================
-- 2. 窗口管理
-- =======================
map("n", "<C-h>", "<C-w>h", { desc = icons.arrow_left .. "焦点左窗口" })
map("t", "<C-h>", "<C-\\><C-n><C-w>h", { desc = icons.arrow_left .. "焦点左窗口" })

-- =======================
-- 4. 剪贴板
-- =======================
map("v", "<C-c>", '"+y', { desc = icons.copy .. "复制到系统剪贴板" })
```

---

## 🎯 优化效果

### 视觉改进
- ✅ **统一图标风格** - 所有键位都有图标，与 dashboard 风格一致
- ✅ **美观的 which-key 界面** - 图标让功能一目了然
- ✅ **专业感提升** - 配置更加专业和现代化

### 可维护性改进
- ✅ **清晰的分组结构** - 按功能分组，易于查找和维护
- ✅ **统一的描述格式** - 中文 + 图标，格式一致
- ✅ **良好的注释** - 每个功能组都有清晰的注释说明

### 可读性改进
- ✅ **逻辑顺序** - 相关功能放在一起，符合使用习惯
- ✅ **中文描述** - 更容易理解功能
- ✅ **图标辅助** - 图标帮助快速识别功能类别

---

## 📝 使用说明

### 查看键位
- 按 `<leader>`（空格）后等待，which-key 会显示所有可用键位
- 按 `<leader>?` 查看当前 buffer 的键位
- 按 `<leader>fk` 查看所有快捷键

### 图标说明
所有图标都定义在 `utils.lua` 的 `M.icons.keymaps` 中，可以根据需要修改：
- 文件相关：`find_file`、`git_files`、`recent_files` 等
- 搜索相关：`grep`、`grep_word`、`scope` 等
- Git 相关：`git_status`、`git_stash`、`git_diff` 等
- 窗口管理：`arrow_left`、`arrow_right`、`arrow_up`、`arrow_down`
- 编辑操作：`move_down`、`move_up`、`copy`
- 导航：`prev`、`next`

---

## 🔄 后续优化建议

### 可选优化
1. **键位冲突检测** - 添加自动检测重复映射的功能
2. **键位速查表** - 生成 markdown 格式的键位速查表
3. **分组优化** - 考虑将 Neovim 内部功能移到 `<leader>n` 前缀
4. **更多图标** - 根据使用情况添加更多图标

### 注意事项
- 图标使用的是 Nerd Fonts，确保终端字体支持
- 如果图标显示异常，检查终端字体配置
- 可以根据个人喜好调整图标和描述

---

## 📚 相关文档

- [Keymap 配置深度分析](./keymap-analysis.md) - 详细的问题分析和优化方案
- [Keymap 速查指南](./keymap-guide.md) - 键位配置语法说明
